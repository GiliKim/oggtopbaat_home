<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì˜¥íƒ‘ë°­ ì‘ë¬¼ DB</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ…</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState, useRef } = React;

      // ---------------- ìœ í‹¸ ----------------
      function monthInRange(m, start, end) {
        if (!start || !end) return false;
        if (start <= end) return m >= start && m <= end;
        return m >= start || m <= end; // ì—°ë„ ê±¸ì¹¨ ì²˜ë¦¬
      }
      function clampMonth(v) {
        const n = Number(v);
        if (Number.isNaN(n)) return 1;
        return Math.min(12, Math.max(1, Math.floor(n)));
      }

      // CSV ìœ í‹¸ (RFC4180 ìŠ¤íƒ€ì¼ ê°„ë‹¨ êµ¬í˜„)
      function toCSV(rows) {
        const esc = (s) => {
          const str = String(s ?? "");
          if (/[",\n]/.test(str)) return '"' + str.replace(/"/g, '""') + '"';
          return str;
        };
        return rows.map(r => r.map(esc).join(",")).join("\n");
      }
      function parseCSV(text) {
        const out = [];
        let row = [], field = "", i = 0, inQuotes = false;
        while (i < text.length) {
          const ch = text[i];
          if (inQuotes) {
            if (ch === '"') {
              if (text[i+1] === '"') { field += '"'; i += 2; continue; }
              inQuotes = false; i++; continue;
            } else { field += ch; i++; continue; }
          } else {
            if (ch === '"') { inQuotes = true; i++; continue; }
            if (ch === ',') { row.push(field); field = ""; i++; continue; }
            if (ch === '\n' || ch === '\r') {
              // handle \r\n and \n
              if (ch === '\r' && text[i+1] === '\n') i++;
              row.push(field); out.push(row); row = []; field = ""; i++; continue;
            }
            field += ch; i++;
          }
        }
        // last field
        row.push(field); out.push(row);
        // remove empty trailing line if any
        if (out.length && out[out.length-1].length===1 && out[out.length-1][0]==="") out.pop();
        return out;
      }

      // ---------------- ê¸°ë³¸ê°’ ----------------
      const DEFAULT_FAMILIES = [
        "ì¥ë¯¸ê³¼","ê°€ì§€ê³¼","ë°•ê³¼","ë¯¸ë‚˜ë¦¬ê³¼","ì‹­ìí™”ê³¼","ë²¼ê³¼","ì½©ê³¼","ê¿€í’€ê³¼","êµ­í™”ê³¼","ë¹„ë¦„ê³¼"
      ];
      const DEFAULT_TYPES = [
        "ê³¼ì±„ë¥˜","ì—½ì±„ë¥˜","ê³¡ë¥˜","ê·¼ì±„ë¥˜","ê²°êµ¬ì±„ë¥˜","í™”ì±„ë¥˜","í—ˆë¸Œë¥˜","ë‘ë¥˜"
      ];

      const SEED = [
        { id: crypto.randomUUID(), name: "í† ë§ˆí† ", family: "ê°€ì§€ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 6, harvestEnd: 9, addedBy: "ê¸°ë³¸", tags: ["ì—¬ë¦„ì‘ë¬¼"] },
        { id: crypto.randomUUID(), name: "ë°©ìš¸í† ë§ˆí† ", family: "ê°€ì§€ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 6, harvestEnd: 10, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ê³ ì¶”", family: "ê°€ì§€ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 7, harvestEnd: 10, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ì˜¤ì´", family: "ë°•ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 4, plantEnd: 6, harvestStart: 6, harvestEnd: 9, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ê°€ì§€", family: "ê°€ì§€ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 6, harvestEnd: 9, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ìˆ˜ë°•", family: "ë°•ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 4, plantEnd: 5, harvestStart: 7, harvestEnd: 8, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ì°¸ì™¸", family: "ë°•ê³¼", type: "ê³¼ì±„ë¥˜", plantStart: 4, plantEnd: 5, harvestStart: 7, harvestEnd: 8, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ìƒì¶”", family: "êµ­í™”ê³¼", type: "ì—½ì±„ë¥˜", plantStart: 3, plantEnd: 10, harvestStart: 4, harvestEnd: 11, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ì‹œê¸ˆì¹˜", family: "ë¹„ë¦„ê³¼", type: "ì—½ì±„ë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 4, harvestEnd: 6, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ë°°ì¶”", family: "ì‹­ìí™”ê³¼", type: "ê²°êµ¬ì±„ë¥˜", plantStart: 8, plantEnd: 9, harvestStart: 10, harvestEnd: 11, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ë¬´", family: "ì‹­ìí™”ê³¼", type: "ê·¼ì±„ë¥˜", plantStart: 8, plantEnd: 9, harvestStart: 10, harvestEnd: 11, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ë‹¹ê·¼", family: "ë¯¸ë‚˜ë¦¬ê³¼", type: "ê·¼ì±„ë¥˜", plantStart: 3, plantEnd: 6, harvestStart: 6, harvestEnd: 10, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "íŒŒìŠ¬ë¦¬", family: "ë¯¸ë‚˜ë¦¬ê³¼", type: "í—ˆë¸Œë¥˜", plantStart: 3, plantEnd: 6, harvestStart: 5, harvestEnd: 10, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ë°”ì§ˆ", family: "ê¿€í’€ê³¼", type: "í—ˆë¸Œë¥˜", plantStart: 4, plantEnd: 6, harvestStart: 6, harvestEnd: 9, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ê°•ë‚­ì½©", family: "ì½©ê³¼", type: "ë‘ë¥˜", plantStart: 4, plantEnd: 6, harvestStart: 7, harvestEnd: 9, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ì™„ë‘ì½©", family: "ì½©ê³¼", type: "ë‘ë¥˜", plantStart: 3, plantEnd: 4, harvestStart: 5, harvestEnd: 6, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ì˜¥ìˆ˜ìˆ˜", family: "ë²¼ê³¼", type: "ê³¡ë¥˜", plantStart: 4, plantEnd: 5, harvestStart: 7, harvestEnd: 8, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ë¸Œë¡œì½œë¦¬", family: "ì‹­ìí™”ê³¼", type: "í™”ì±„ë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 6, harvestEnd: 10, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ë£¨ê¼´ë¼", family: "ì‹­ìí™”ê³¼", type: "ì—½ì±„ë¥˜", plantStart: 3, plantEnd: 9, harvestStart: 4, harvestEnd: 11, addedBy: "ê¸°ë³¸", tags: [] },
        { id: crypto.randomUUID(), name: "ê³ ìˆ˜", family: "ë¯¸ë‚˜ë¦¬ê³¼", type: "í—ˆë¸Œë¥˜", plantStart: 3, plantEnd: 5, harvestStart: 5, harvestEnd: 7, addedBy: "ê¸°ë³¸", tags: [] }
      ];

      const LS_KEY = "otoba_crops_v6";          // ì‘ë¬¼ ì €ì¥ í‚¤ (CSV ë“± ê¸°ëŠ¥ ì¶”ê°€ë¡œ ë²„ì „ì—…)
      const LS_KEY_OPTS = "otoba_crops_opts_v1"; // ì‚¬ìš©ì ì •ì˜ ê³¼/ì¢…ë¥˜ ì €ì¥ í‚¤

      function Tabs({ active, onChange }) {
        const item = (key, label) => (
          <button
            onClick={() => onChange(key)}
            className={
              "px-4 py-2 text-sm rounded-t-xl border-b-2 " +
              (active === key ? "border-black font-semibold bg-white" : "border-transparent text-gray-500 hover:text-gray-800")
            }
          >{label}</button>
        );
        return (
          <div className="flex gap-2">
            {item("search", "ê²€ìƒ‰ Â· ë¦¬ìŠ¤íŠ¸")}
            {item("register", "ë“±ë¡í•˜ê¸°")}
          </div>
        );
      }

      function App() {
        const [crops, setCrops] = useState([]);
        const [families, setFamilies] = useState(DEFAULT_FAMILIES);
        const [types, setTypes] = useState(DEFAULT_TYPES);

        const [name, setName] = useState("");
        const [family, setFamily] = useState("");
        const [type, setType] = useState("");
        const [plantStart, setPlantStart] = useState("");
        const [plantEnd, setPlantEnd] = useState("");
        const [harvestStart, setHarvestStart] = useState("");
        const [harvestEnd, setHarvestEnd] = useState("");
        const [addedBy, setAddedBy] = useState("");
        const [tagsInput, setTagsInput] = useState("");

        const [mode, setMode] = useState("plant");
        const [queryMonth, setQueryMonth] = useState("");
        const [textFilter, setTextFilter] = useState("");
        const [familyFilter, setFamilyFilter] = useState("ì „ì²´");
        const [typeFilter, setTypeFilter] = useState("ì „ì²´");
        const [editingId, setEditingId] = useState(null);
        const [activeTab, setActiveTab] = useState("search");
        const [allView, setAllView] = useState(false);

        const fileInputRef = useRef();

        // ì´ˆê¸° ë¡œë“œ (ì‘ë¬¼ + ì‚¬ìš©ì ì •ì˜ ì˜µì…˜)
        useEffect(() => {
          const raw = localStorage.getItem(LS_KEY);
          if (raw) {
            try { const parsed = JSON.parse(raw); if (Array.isArray(parsed)) setCrops(parsed); } catch {}
          } else {
            setCrops(SEED);
          }
          const opts = localStorage.getItem(LS_KEY_OPTS);
          if (opts) {
            try {
              const parsed = JSON.parse(opts);
              const savedFamilies = Array.isArray(parsed?.families) ? parsed.families : [];
              const savedTypes = Array.isArray(parsed?.types) ? parsed.types : [];
              setFamilies(Array.from(new Set([...DEFAULT_FAMILIES, ...savedFamilies])).sort());
              setTypes(Array.from(new Set([...DEFAULT_TYPES, ...savedTypes])).sort());
            } catch {}
          }
        }, []);

        // ì €ì¥
        useEffect(() => { localStorage.setItem(LS_KEY, JSON.stringify(crops)); }, [crops]);
        useEffect(() => { localStorage.setItem(LS_KEY_OPTS, JSON.stringify({ families, types })); }, [families, types]);

        const now = new Date();
        const defaultMonth = now.getMonth() + 1;
        const monthToCheck = useMemo(() => {
          if (queryMonth) {
            const m = Number(queryMonth);
            if (!Number.isNaN(m) && m >= 1 && m <= 12) return m;
          }
          return defaultMonth;
        }, [queryMonth, defaultMonth]);

        // ëª¨ë“  íƒœê·¸ ìˆ˜ì§‘ (ìë™ì™„ì„±ìš©)
        const allTags = useMemo(() => {
          const s = new Set();
          crops.forEach(c => (c.tags||[]).forEach(t => s.add(t)));
          return Array.from(s).sort((a,b)=>a.localeCompare(b));
        }, [crops]);

        // í˜„ì¬ ì…ë ¥ì—ì„œ ë§ˆì§€ë§‰ í† í°ìœ¼ë¡œ ì¶”ì²œ ê³„ì‚°
        const tagTokens = useMemo(() => tagsInput.split(',').map(t=>t.trim()).filter(Boolean), [tagsInput]);
        const lastToken = useMemo(() => {
          const parts = tagsInput.split(',');
          return parts[parts.length-1].trim();
        }, [tagsInput]);
        const tagSuggestions = useMemo(() => {
          if (!lastToken) return [];
          const lower = lastToken.toLowerCase();
          const existing = new Set(tagTokens.map(t=>t.toLowerCase()));
          return allTags.filter(t => t.toLowerCase().startsWith(lower) && !existing.has(t.toLowerCase())).slice(0,8);
        }, [allTags, lastToken, tagTokens]);
        function addTagFromSuggestion(t){
          const tokens = tagsInput.split(',').map(s=>s.trim()).filter(Boolean);
          if (!tokens.includes(t)) tokens.push(t);
          setTagsInput(tokens.join(', ') + ', ');
        }
        function removeTagAt(idx){
          const tokens = tagsInput.split(',').map(s=>s.trim()).filter(Boolean);
          tokens.splice(idx,1);
          setTagsInput(tokens.join(', '));
        }

        // íˆíŠ¸ë§µ ë°ì´í„°
        const monthStats = useMemo(() => {
          const plant = Array(12).fill(0), harvest = Array(12).fill(0);
          crops.forEach(c => { for (let m=1;m<=12;m++){ if(monthInRange(m,c.plantStart,c.plantEnd)) plant[m-1]++; if(monthInRange(m,c.harvestStart,c.harvestEnd)) harvest[m-1]++; } });
          const maxP = Math.max(...plant, 1), maxH = Math.max(...harvest, 1);
          return { plant, harvest, maxP, maxH };
        }, [crops]);
        const intensity = (v,max)=>`hsl(140 60% ${95 - Math.round((v/(max||1))*55)}%)`;
        const intensityHarvest = (v,max)=>`hsl(20 80% ${95 - Math.round((v/(max||1))*55)}%)`;

        const filtered = useMemo(() => {
          const qs = textFilter.trim().toLowerCase().split(/\s+/).filter(Boolean);
          return crops.filter(c => {
            if (familyFilter !== "ì „ì²´" && c.family !== familyFilter) return false;
            if (typeFilter !== "ì „ì²´" && c.type !== typeFilter) return false;
            if (qs.length) {
              const hay = [c.name, c.family, c.type, c.addedBy, ...(c.tags||[])].join(" ").toLowerCase();
              if (!qs.every(w => hay.includes(w))) return false;
            }
            if (allView) return true;
            return mode === "plant" ? monthInRange(monthToCheck, c.plantStart, c.plantEnd)
                                     : monthInRange(monthToCheck, c.harvestStart, c.harvestEnd);
          });
        }, [crops, textFilter, familyFilter, typeFilter, mode, monthToCheck, allView]);

        function resetForm(){ setName(""); setFamily(""); setType(""); setPlantStart(""); setPlantEnd(""); setHarvestStart(""); setHarvestEnd(""); setAddedBy(""); setTagsInput(""); setEditingId(null); }

        function handleAddFamily(){
          const v = (prompt("ì¶”ê°€í•  ê³¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”")||"").trim();
          if(!v) return; if (families.map(s=>s.toLowerCase()).includes(v.toLowerCase())) { alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤"); return; }
          setFamilies(prev=>Array.from(new Set([...prev, v])).sort());
        }
        function handleAddType(){
          const v = (prompt("ì¶”ê°€í•  ì¢…ë¥˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”")||"").trim();
          if(!v) return; if (types.map(s=>s.toLowerCase()).includes(v.toLowerCase())) { alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤"); return; }
          setTypes(prev=>Array.from(new Set([...prev, v])).sort());
        }

        function handleSubmit(e){
          e.preventDefault();
          const ps = clampMonth(plantStart), pe = clampMonth(plantEnd), hs = clampMonth(harvestStart), he = clampMonth(harvestEnd);
          if(!name.trim()||!family.trim()||!type.trim()||!addedBy.trim()) { alert("ì´ë¦„, ê³¼, ì¢…ë¥˜, ë“±ë¡ìë¥¼ ì…ë ¥í•˜ì„¸ìš”"); return; }
          const newCrop = { id: editingId ?? crypto.randomUUID(), name: name.trim(), family: family.trim(), type: type.trim(), plantStart: ps, plantEnd: pe, harvestStart: hs, harvestEnd: he, addedBy: addedBy.trim(), tags: tagsInput.split(",").map(t=>t.trim()).filter(Boolean) };
          setCrops(prev => editingId ? prev.map(c=>c.id===editingId?newCrop:c) : [newCrop, ...prev]);
          resetForm(); setActiveTab("search");
        }
        function handleEdit(c){ setActiveTab("register"); setEditingId(c.id); setName(c.name); setFamily(c.family); setType(c.type); setPlantStart(String(c.plantStart)); setPlantEnd(String(c.plantEnd)); setHarvestStart(String(c.harvestStart)); setHarvestEnd(String(c.harvestEnd)); setAddedBy(c.addedBy); setTagsInput((c.tags||[]).join(", ")); window.scrollTo({top:0, behavior:"smooth"}); }
        function handleDelete(id){ if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return; setCrops(prev=>prev.filter(c=>c.id!==id)); if(editingId===id) resetForm(); }

        // CSV ë‚´ë³´ë‚´ê¸°
        function exportCSV(){
          const header = ["name","family","type","plantStart","plantEnd","harvestStart","harvestEnd","addedBy","tags"];
          const rows = [header, ...crops.map(c => [
            c.name, c.family, c.type, c.plantStart, c.plantEnd, c.harvestStart, c.harvestEnd, c.addedBy, (c.tags||[]).join(';')
          ])];
          const csv = toCSV(rows);
          const blob = new Blob(["\uFEFF" + csv], {type: 'text/csv;charset=utf-8;'}); // BOM í¬í•¨ (ì—‘ì…€ í˜¸í™˜)
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = `ì˜¥íƒ‘ë°­_ì‘ë¬¼DB_${new Date().toISOString().slice(0,10)}.csv`;
          document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        }

        // CSV ê°€ì ¸ì˜¤ê¸° (ì¶”ê°€/ë®ì–´ì“°ê¸° ì„ íƒ)
        function importCSV(mode, file){
          const reader = new FileReader();
          reader.onload = () => {
            try{
              const text = reader.result;
              const rows = parseCSV(text);
              if (!rows.length) return alert('ë¹„ì–´ìˆëŠ” íŒŒì¼ì…ë‹ˆë‹¤');
              const header = rows[0].map(h=>h.trim());
              const idx = (name) => header.indexOf(name);
              const need = ["name","family","type","plantStart","plantEnd","harvestStart","harvestEnd","addedBy","tags"];
              if (!need.every(n=>idx(n) !== -1)) return alert('í—¤ë”ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. í•„ìš”í•œ í—¤ë”: ' + need.join(', '));
              const imported = rows.slice(1).filter(r=>r.length>1).map(r=>({
                id: crypto.randomUUID(),
                name: r[idx('name')]?.trim()||'',
                family: r[idx('family')]?.trim()||'',
                type: r[idx('type')]?.trim()||'',
                plantStart: clampMonth(r[idx('plantStart')]),
                plantEnd: clampMonth(r[idx('plantEnd')]),
                harvestStart: clampMonth(r[idx('harvestStart')]),
                harvestEnd: clampMonth(r[idx('harvestEnd')]),
                addedBy: r[idx('addedBy')]?.trim()||'',
                tags: (r[idx('tags')]||'').split(';').map(t=>t.trim()).filter(Boolean)
              }));
              if (mode==='replace') setCrops(imported);
              else setCrops(prev=>[...imported, ...prev]);
              alert(`ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ: ${imported.length}ê±´`);
            }catch(e){ console.error(e); alert('ê°€ì ¸ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'); }
          };
          reader.readAsText(file, 'utf-8');
        }

        function onImportClick(mode){
          const input = fileInputRef.current; if (!input) return;
          input.onchange = (e)=>{
            const file = e.target.files?.[0];
            if (file) importCSV(mode, file);
            input.value = '';
          };
          input.click();
        }

        return (
          <div className="min-h-screen p-6">
            <input ref={fileInputRef} type="file" accept=".csv,text/csv" className="hidden" />
            <header className="mb-4 flex items-center gap-3 flex-wrap">
              <div>
                <h1 className="text-2xl font-extrabold">ì˜¥íƒ‘ë°­ ì‘ë¬¼ DB</h1>
                <p className="text-sm text-gray-600">ë¡œì»¬ ì €ì¥ Â· 20ê°œ ê¸°ë³¸ ë°ì´í„° Â· ê³¼/ì¢…ë¥˜ ë“œë¡­ë‹¤ìš´(ì‚¬ìš©ì ì¶”ê°€) Â· CSV Â· íƒœê·¸ ìë™ì™„ì„±</p>
              </div>
              <div className="ml-auto flex gap-2">
                <button onClick={exportCSV} className="px-3 py-2 rounded-lg border hover:bg-gray-50" title="í˜„ì¬ ëª©ë¡ì„ CSVë¡œ ë‹¤ìš´ë¡œë“œ">CSV ë‚´ë³´ë‚´ê¸°</button>
                <button onClick={()=>onImportClick('append')} className="px-3 py-2 rounded-lg border hover:bg-gray-50" title="CSVë¥¼ ì½ì–´ í˜„ì¬ ëª©ë¡ì— ì¶”ê°€">ê°€ì ¸ì˜¤ê¸°(ì¶”ê°€)</button>
                <button onClick={()=>{ if(confirm('CSVë¡œ ë®ì–´ì“°ì‹œê² ì–´ìš”? í˜„ì¬ ë°ì´í„°ê°€ ì§€ì›Œì§‘ë‹ˆë‹¤.')) onImportClick('replace'); }} className="px-3 py-2 rounded-lg border hover:bg-gray-50" title="CSVë¡œ í˜„ì¬ ëª©ë¡ì„ êµì²´">ê°€ì ¸ì˜¤ê¸°(ë®ì–´ì“°ê¸°)</button>
              </div>
            </header>

            <div className="bg-white rounded-2xl shadow p-4">
              <Tabs active={activeTab} onChange={setActiveTab} />
              <div className="mt-4 border-t" />

              {/* íƒ­1: ê²€ìƒ‰/ë¦¬ìŠ¤íŠ¸ */}
              {activeTab === "search" && (
                <section className="pt-4">
                  <div className="flex flex-wrap items-end gap-3 mb-4">
                    <div className="flex flex-col">
                      <label className="text-xs text-gray-500 mb-1">ëª¨ë“œ</label>
                      <select value={mode} onChange={(e) => setMode(e.target.value)} className="border rounded-lg px-3 py-2">
                        <option value="plant">ì‹¬ì„ ìˆ˜ ìˆëŠ”</option>
                        <option value="harvest">ìˆ˜í™• ê°€ëŠ¥í•œ</option>
                      </select>
                    </div>
                    <div className="flex flex-col">
                      <label className="text-xs text-gray-500 mb-1">ì›” (1~12)</label>
                      <input type="number" min={1} max={12} value={queryMonth} onChange={(e) => setQueryMonth(e.target.value)} placeholder={(new Date().getMonth()+1).toString()} className="border rounded-lg px-3 py-2 w-28" />
                    </div>
                    <div className="flex flex-col">
                      <label className="text-xs text-gray-500 mb-1">ì¢…ë¥˜</label>
                      <select value={typeFilter} onChange={(e)=> setTypeFilter(e.target.value)} className="border rounded-lg px-3 py-2">
                        {["ì „ì²´", ...types].map(s => <option key={s} value={s}>{s}</option>)}
                      </select>
                    </div>
                    <div className="flex flex-col">
                      <label className="text-xs text-gray-500 mb-1">ê³¼(íŒ¨ë°€ë¦¬)</label>
                      <select value={familyFilter} onChange={(e) => setFamilyFilter(e.target.value)} className="border rounded-lg px-3 py-2">
                        {["ì „ì²´", ...families].map(f => <option key={f} value={f}>{f}</option>)}
                      </select>
                    </div>
                    <div className="flex items-center gap-2 ml-auto">
                      <input id="allView" type="checkbox" className="scale-110" checked={allView} onChange={(e)=>setAllView(e.target.checked)} />
                      <label htmlFor="allView" className="text-sm text-gray-700">ì „ì²´ë³´ê¸° (ì›”/ëª¨ë“œ ë¬´ì‹œ)</label>
                    </div>
                    <div className="flex flex-col grow min-w-[240px]">
                      <label className="text-xs text-gray-500 mb-1">ë‹¤ì¤‘ê²€ìƒ‰ (ê³µë°± êµ¬ë¶„: ì´ë¦„/ê³¼/ì¢…ë¥˜/ë“±ë¡ì/íƒœê·¸)</label>
                      <input type="text" value={textFilter} onChange={(e) => setTextFilter(e.target.value)} className="border rounded-lg px-3 py-2" placeholder="ì˜ˆ: ë°•ê³¼ ê³¼ì±„ë¥˜ ê´€ë¦¬ì" />
                    </div>
                  </div>

                  {/* íˆíŠ¸ë§µ */}
                  <div className="grid md:grid-cols-2 gap-4 mb-4">
                    <div className="bg-white border rounded-xl p-4">
                      <h4 className="font-semibold mb-2">ì›”ë³„ íŒŒì¢… íˆíŠ¸ë§µ</h4>
                      <div className="grid grid-cols-12 gap-1">
                        {monthStats.plant.map((v,i)=> (
                          <button key={i} onClick={()=>{ setMode("plant"); setQueryMonth(String(i+1)); setAllView(false); }} title={`${i+1}ì›”: íŒŒì¢… ${v}ì¢…`} className="h-10 rounded" style={{background:intensity(v, monthStats.maxP)}}>
                            <span className="text-[10px] block text-center">{i+1}</span>
                          </button>
                        ))}
                      </div>
                    </div>
                    <div className="bg-white border rounded-xl p-4">
                      <h4 className="font-semibold mb-2">ì›”ë³„ ìˆ˜í™• íˆíŠ¸ë§µ</h4>
                      <div className="grid grid-cols-12 gap-1">
                        {monthStats.harvest.map((v,i)=> (
                          <button key={i} onClick={()=>{ setMode("harvest"); setQueryMonth(String(i+1)); setAllView(false); }} title={`${i+1}ì›”: ìˆ˜í™• ${v}ì¢…`} className="h-10 rounded" style={{background:intensityHarvest(v, monthStats.maxH)}}>
                            <span className="text-[10px] block text-center">{i+1}</span>
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>

                  <h3 className="text-sm font-semibold text-gray-700 mb-2">ê²°ê³¼ ({filtered.length}ê°œ)</h3>
                  <div className="overflow-auto rounded-xl border">
                    <table className="min-w-full text-sm">
                      <thead className="bg-gray-100">
                        <tr>
                          <th className="text-left p-2">ì´ë¦„</th>
                          <th className="text-left p-2">ê³¼(íŒ¨ë°€ë¦¬)</th>
                          <th className="text-left p-2">ì¢…ë¥˜</th>
                          <th className="text-left p-2">ì‹¬ëŠ” ì‹œê¸°</th>
                          <th className="text-left p-2">ìˆ˜í™• ì‹œê¸°</th>
                          <th className="text-left p-2">íƒœê·¸</th>
                          <th className="text-left p-2">ë“±ë¡ì</th>
                          <th className="text-left p-2">ê´€ë¦¬</th>
                        </tr>
                      </thead>
                      <tbody>
                        {filtered.map((c) => (
                          <tr key={c.id} className="border-t hover:bg-gray-50"
                              title={`ê³¼: ${c.family} / ì¢…ë¥˜: ${c.type}\níŒŒì¢…: ${c.plantStart}~${c.plantEnd}ì›”, ìˆ˜í™•: ${c.harvestStart}~${c.harvestEnd}ì›”\níƒœê·¸: ${(c.tags||[]).join(', ')}`}
                          >
                            <td className="p-2 font-medium">{c.name}</td>
                            <td className="p-2">{c.family}</td>
                            <td className="p-2">{c.type}</td>
                            <td className="p-2">{c.plantStart}~{c.plantEnd}ì›”</td>
                            <td className="p-2">{c.harvestStart}~{c.harvestEnd}ì›”</td>
                            <td className="p-2">
                              <div className="flex flex-wrap gap-1">{(c.tags||[]).map(t => <span key={t} className="px-2 py-0.5 text-xs rounded-full bg-gray-100" title={`íƒœê·¸: ${t}`}>#{t}</span>)}</div>
                            </td>
                            <td className="p-2">{c.addedBy}</td>
                            <td className="p-2">
                              <button onClick={() => handleEdit(c)} className="px-2 py-1 text-xs rounded-lg bg-blue-50 hover:bg-blue-100">ìˆ˜ì •</button>
                              <button onClick={() => handleDelete(c.id)} className="ml-2 px-2 py-1 text-xs rounded-lg bg-red-50 hover:bg-red-100">ì‚­ì œ</button>
                            </td>
                          </tr>
                        ))}
                        {filtered.length === 0 && (
                          <tr>
                            <td className="p-3 text-center text-gray-500" colSpan={8}>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                          </tr>
                        )}
                      </tbody>
                    </table>
                  </div>
                </section>
              )}

              {/* íƒ­2: ë“±ë¡í•˜ê¸° */}
              {activeTab === "register" && (
                <section className="pt-4">
                  <h2 className="font-bold mb-3">ì‘ë¬¼ ë“±ë¡/ìˆ˜ì •</h2>
                  <form onSubmit={handleSubmit} className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input value={name} onChange={(e) => setName(e.target.value)} placeholder="ì‘ë¬¼ ì´ë¦„" className="border rounded-lg px-3 py-2" />

                    <div className="flex flex-col">
                      <label className="text-xs text-gray-500 mb-1">ê³¼(íŒ¨ë°€ë¦¬)</label>
                      <div className="flex gap-2">
                        <select value={family} onChange={(e)=> setFamily(e.target.value)} className="border rounded-lg px-3 py-2 w-full">
                          <option value="">ì„ íƒ</option>
                          {families.map(f => <option key={f} value={f}>{f}</option>)}
                        </select>
                        <button type="button" className="px-3 py-2 rounded-lg border" onClick={handleAddFamily}>+ ì¶”ê°€</button>
                      </div>
                    </div>

                    <div className="flex flex-col">
                      <label className="text-xs text-gray-500 mb-1">ì¢…ë¥˜</label>
                      <div className="flex gap-2">
                        <select value={type} onChange={(e)=> setType(e.target.value)} className="border rounded-lg px-3 py-2 w-full">
                          <option value="">ì„ íƒ</option>
                          {types.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                        <button type="button" className="px-3 py-2 rounded-lg border" onClick={handleAddType}>+ ì¶”ê°€</button>
                      </div>
                    </div>

                    <input type="number" min={1} max={12} value={plantStart} onChange={(e) => setPlantStart(e.target.value)} placeholder="ì‹¬ëŠ” ì‹œê¸° ì‹œì‘(ì›”)" className="border rounded-lg px-3 py-2" />
                    <input type="number" min={1} max={12} value={plantEnd} onChange={(e) => setPlantEnd(e.target.value)} placeholder="ì‹¬ëŠ” ì‹œê¸° ë(ì›”)" className="border rounded-lg px-3 py-2" />
                    <input type="number" min={1} max={12} value={harvestStart} onChange={(e) => setHarvestStart(e.target.value)} placeholder="ìˆ˜í™• ì‹œê¸° ì‹œì‘(ì›”)" className="border rounded-lg px-3 py-2" />
                    <input type="number" min={1} max={12} value={harvestEnd} onChange={(e) => setHarvestEnd(e.target.value)} placeholder="ìˆ˜í™• ì‹œê¸° ë(ì›”)" className="border rounded-lg px-3 py-2" />

                    <input value={addedBy} onChange={(e) => setAddedBy(e.target.value)} placeholder="ë“±ë¡ì" className="border rounded-lg px-3 py-2" />

                    {/* íƒœê·¸ ì…ë ¥ + ìë™ì™„ì„± */}
                    <div className="sm:col-span-2">
                      <label className="text-xs text-gray-500 mb-1">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                      <input value={tagsInput} onChange={(e)=> setTagsInput(e.target.value)} placeholder="ì˜ˆ: ì—¬ë¦„ì‘ë¬¼, ë©êµ´, ì´ˆë³´ì¶”ì²œ" className="border rounded-lg px-3 py-2 w-full" />
                      {/* í˜„ì¬ í† í°ë“¤(ì¹©) */}
                      <div className="mt-2 flex flex-wrap gap-2">
                        {tagTokens.map((t,idx)=> (
                          <span key={idx} className="px-2 py-1 text-xs rounded-full bg-gray-100 flex items-center gap-1" title={`íƒœê·¸: ${t}`}>
                            #{t}
                            <button type="button" className="ml-1 text-gray-500 hover:text-black" onClick={()=>removeTagAt(idx)} aria-label="íƒœê·¸ ì œê±°">Ã—</button>
                          </span>
                        ))}
                      </div>
                      {/* ì¶”ì²œ ëª©ë¡ */}
                      {tagSuggestions.length>0 && (
                        <div className="mt-2 p-2 border rounded-lg bg-white shadow-sm">
                          <div className="text-xs text-gray-500 mb-1">ì¶”ì²œ íƒœê·¸</div>
                          <div className="flex flex-wrap gap-2">
                            {tagSuggestions.map(t => (
                              <button type="button" key={t} onClick={()=>addTagFromSuggestion(t)} className="px-2 py-1 text-xs rounded-full border hover:bg-gray-50" title={`íƒœê·¸ ì¶”ê°€: ${t}`}>#{t}</button>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="col-span-full flex gap-2 mt-1">
                      <button type="submit" className="px-4 py-2 rounded-xl bg-black text-white hover:opacity-90">{editingId ? "ìˆ˜ì • ì €ì¥" : "ë“±ë¡"}</button>
                      {editingId && (
                        <button type="button" className="px-4 py-2 rounded-xl border hover:bg-gray-50" onClick={() => { setEditingId(null); resetForm(); }}>ì·¨ì†Œ</button>
                      )}
                    </div>
                  </form>

                  <p className="text-xs text-gray-500 mt-3">* ì›” ë²”ìœ„ëŠ” ì—°ë„ë¥¼ ë„˜ê²¨ë„ ë©ë‹ˆë‹¤. (ì˜ˆ: 11~2ì›”)</p>
                </section>
              )}
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
